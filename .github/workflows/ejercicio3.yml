name: Issue al abrir una pull request
on:
  pull_request:
    types: 
      - opened
      - reopened

jobs:
  issue:
    permissions:
      issues: write
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: | 
          pull_request_url="${{ github.event.pull_request.html_url }}"
          issue_body="This issue is related to pull request: [${pull_request_url}](${pull_request_url})"
          gh issue create --title "I found a bug" --body "${issue_body}" -a "EperezStemdo"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: AÃ±adir closes a la pr
        run: |
          pr_number="${{ github.event.pull_request.number }}"
          issue_number=$(echo "${pr_body}" | grep -oE '#[0-9]+' | head -n1)
          new_pr_body="Closes #${issue_number}"
          gh pr edit "${pr_number}"  --body "${new_pr_body}"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}    
          
  
