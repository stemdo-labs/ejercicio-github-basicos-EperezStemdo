name: Issue al abrir una pull request
on:
  pull_request:
    types: 
      - opened
      - reopened

jobs:
  issue:
    permissions:
      issues: write
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: | 
          pull_request_url="${{ github.event.pull_request.html_url }}"
          issue_body="This issue is related to pull request: [${pull_request_url}](${pull_request_url})"
          gh issue create --title "I found a bug" --body "${issue_body}" -a "EperezStemdo"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - run: | 
          pull_request_url="${{ github.event.pull_request.html_url }}"
          issue_body="This issue is related to pull request: [${pull_request_url}](${pull_request_url})"
          gh issue create --title "I found a bug" --body "${issue_body}" -a "EperezStemdo"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}  
          
      - name: Cerrar issue cuando se cierra la pull request
        if: github.event.pull_request.merged == true || github.event.pull_request.closed_at != null
        #github.event.pull_request.closed_at != null es una condici贸n que verifica si el campo closed_at en el JSON del evento de la solicitud de extracci贸n tiene un valor diferente de null. Este campo contiene la fecha y hora en que se cerr贸 la solicitud de extracci贸n.
        run: |
          issue_number=$(echo '${{ github.event.pull_request.number }}')
          gh issue close $issue_number
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
