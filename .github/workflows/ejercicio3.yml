name: Issue al abrir una pull requestw
on:
  pull_request:
    types: 
      - opened
      - reopened

jobs:
  issue:
    permissions:
      issues: write
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: | 
          pull_request_url="${{ github.event.pull_request.html_url }}"
          issue_body="This issue is related to pull request: [${pull_request_url}](${pull_request_url})"
          gh issue create --title "I found a bug" --body "${issue_body}" -a "EperezStemdo"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Extract issue number
        id: extract_issue_number
        run: |
          pr_url="${{ github.event.pull_request.html_url }}" #url de la pr
          issue_number=$(echo "$pr_url" | grep -oE '[0-9]+$')
          echo "::set-output name=id::$issue_number"
      
      #- name: AÃ±adir closes a la pr
       # run: |
        #  gh pr edit ${{ github.event.number }} --body "Close #${{ steps.extract_issue_number.outputs.id }}"
        #env:
         # GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}    

      - name: Close issue
        if: github.event_name == 'pull_request' && github.event.action == 'closed'
        run: |
          gh issue close ${{ github.event.number }} --comment "Issue has been closed"
          
  
